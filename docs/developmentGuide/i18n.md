---
toc: content
title: '国际化服务库'
order: '15'
glossary: i18n | 国际化 | BOS | API | JSON
---

# 国际化服务库

国际化（Internationalization，简称 i18n）是构建全球化应用的关键能力。「KWC」国际化服务库提供了一套完整的多语言解决方案，帮助你在「苍穹」 平台上开发支持多语言环境的组件和应用。

本章将介绍如何配置与使用「KWC」的多语言方案。

## 功能特性

- 🌍 多语言支持
- 🔄 动态语言切换
- 📦 按需加载语言包
- 🎯 嵌套键值翻译
- 🔧 灵活的配置选项
- 📱 自动检测浏览器语言
- 🏢 集成 BOS 系统语言设置

## 安装

执行以下命令安装依赖包：

    npm install @kdcloudjs/kwc-i18n

## 基本使用

### 导入和初始化

导入核心 API 即可快速实现翻译，无需复杂配置，库会自动初始化中文基础翻译包：

```js
import { t, loadLanguage, changeLocale } from '@kdcloudjs/kwc-i18n';

// 基本翻译
const message = t('alert.defaultLabel'); // "警告"

// 取不到对应词条时使用fallback值替代
const greeting = t('welcome.message', { fallback: 'Welcome' });
```

### 完整 API 导入

导入全部国际化能力，满足复杂开发场景需求：

```js
import {
  t, // 翻译函数
  tAsync, // 异步翻译函数
  lang, // 当前语言
  locale, // 当前语言环境
  loadLanguage, // 加载语言包
  addTranslation, // 添加单个翻译
  addTranslations, // 添加多个翻译
  clearTranslation, // 清除翻译缓存
  getAvailableLanguages, // 获取可用语言
  changeLocale, // 切换语言环境
  onLocaleChange, // 监听语言环境变化
  offLocaleChange, // 移除语言环境监听
} from '@kdcloudjs/kwc-i18n';
```

## 详细使用

### 1. 基本翻译

支持简单键值和嵌套键值两种词条访问方式，嵌套键使用点分隔符层级关联：

```js
// 简单翻译
const label = t('buttonMenu.loading'); // "加载中..."

// 嵌套键值翻译
const color = t('colorPicker.blueAbbr'); // "蓝"
```

### 2. 动态加载语言包

通过 `loadLanguage` 加载指定语言的 JSON 翻译包，支持覆盖模式和合并模式，适配不同加载需求:

```js
// 加载英文语言包
await loadLanguage('en_US', '/path/to/en_US.json');

// 合并模式加载（保留已有翻译）
await loadLanguage('en_US', '/path/to/additional_en_US.json', true);
```

### 3. 添加自定义翻译

无需修改语言包文件，通过 API 实时添加 / 批量添加自定义词条，适用于个性化翻译需求:

```js
// 添加单个翻译
addTranslation('zh_CN', 'custom.message', '自定义消息');

// 添加多个翻译
addTranslations('zh_CN', {
  custom: {
    title: '自定义标题',
    description: '自定义描述',
  },
});
```

### 4. 语言环境管理

实现语言环境的查询、切换与变化监听，适配页面语言动态更新场景:

```js
// 获取当前语言环境
console.log(locale); // 'zh_CN'

// 切换语言环境
changeLocale('en_US');

// 监听语言环境变化
const handleLocaleChange = (newLocale, oldLocale) => {
  console.log(`语言从 ${oldLocale} 切换到 ${newLocale}`);
};

onLocaleChange(handleLocaleChange);

// 移除监听器
offLocaleChange(handleLocaleChange);
```

### 5. 异步翻译

`tAsync` 适用于语言包未提前加载的动态场景，会自动按需加载并返回翻译结果，参数与同步 t 函数兼容:

```js
// 异步获取翻译（适用于需要动态加载的场景）
const asyncMessage = await tAsync('some.key');
const asyncGreeting = await tAsync('welcome.message', { fallback: 'Welcome' });
const asyncFallback = await tAsync('non.existent.key', {
  fallback: 'Fallback',
  path: 'path/to/en_US.json',
});
```

### 6. 清除翻译缓存

清除指定语言的翻译缓存，适用于需要重新加载最新语言包的场景:

```js
// 清除指定语言的翻译缓存
clearTranslation('en_US');
```

---

## 模块化使用

### 单独使用 i18n 模块

```bash
import { t, loadLanguage } from '@kdcloudjs/kwc-i18n/i18n';
```

### 单独使用 locale 模块

```bash
import { setLocale, addLocaleListener } from '@kdcloudjs/kwc-i18n/locale';
```

### 单独使用 lang 模块

```bash
import lang from '@kdcloudjs/kwc-i18n/lang';
```

## 语言检测优先级

系统按以下优先级自动检测语言：

1.  URL 参数中的 `lang` 参数
2.  BOS 系统配置的语言设置
3.  浏览器语言设置
4.  BOS 系统默认语言

## 翻译文件格式

翻译文件应为 JSON 格式，支持多层嵌套对象结构，词条键建议使用驼峰命名，便于维护和访问：

```json
{
  "alert": {
    "defaultLabel": "警告"
  },
  "buttonMenu": {
    "loading": "加载中...",
    "showMenu": "展示菜单"
  },
  "colorPicker": {
    "cancelButton": "取消",
    "doneButton": "完成"
  }
}
```

## 构建和发布

```bash
# 构建项目
npm run build

# 发布前构建
npm run prepublish
```

## 项目结构

库采用模块化架构，功能解耦，便于维护和扩展：

    src/
    ├── index.js              # 主入口文件
    └── modules/
        ├── i18n/            # 核心翻译功能
        ├── lang/            # 语言管理
        ├── locale/          # 语言环境管理
        └── locales/         # 默认翻译文件
            └── zh_CN.json   # 中文翻译

## 注意事项

- 库会自动初始化中文翻译
- 支持 CommonJS 和 ES Module 两种导入方式
- 翻译键支持点号分隔的嵌套访问
- 语言代码格式：`zh_CN`、`en_US` 等

## 许可证

详细许可信息请查看项目根目录的许可证文件。
