---
toc: content
title: '调试与测试'
order: '14'
glossary: OpenAPI
---

# 调试与测试

「KWC」提供完整的调试与测试解决方案，支持从本地开发到生产环境的全链路质量保障。

本章将指导你掌握组件的本地调试（快速预览组件本地效果）和远程联调（对接「苍穹」平台的表单设计器）的核心技能。

## 本地调试

本地开发自定义控件时，快速预览控件自身渲染效果、调试基础功能，无需对接「苍穹」平台环境。

### 操作步骤

1. 打开代码编辑器 VSCode，左侧资源管理器进入「KWC」项目根目录。

```bash
# 进入项目目录
cd myComponent

# 安装依赖（首次或依赖变更时需要）
npm install / yarn install

# 启动开发服务器
npm start / yarn start
```

2. 使用快捷键（Ctrl + `）打开 VSCode 内置终端。
3. 复制启动日志中的链接 http://localhost:8000/ 。
4. 打开任意浏览器，访问该网址，查看组件本地效果。

## 远程联调

将本地开发的控件前端代码，与远程「苍穹」开发环境的设计器 / 表单联动联调，通过命令行直接部署控件元数据到「苍穹」环境，省去打包上传的繁琐步骤，实现本地代码修改后快速同步至远程联调场景。

该远程联调，主要通过 `kd-custom-control-cli` 命令将控件 XML 元数据文件部署到指定「苍穹」环境中，同时在本地启动静态服务器（供远程「苍穹」访问本地前端文件）+ 动态构建服务（本地代码更新后自动编译打包），让远程「苍穹」页面加载本地的前端静态文件，实现本地代码与远程环境的实时联调。

### 第一步：上传控件元数据到「苍穹」环境

上传控件元数据操作，在 myComponent 项目根目录下执行 `kd-custom-control-cli deploy` 命令，然后根据提示输入信息：

    $ kd-custom-control-cli deploy
    √ *请输入方案名称 ... 测试控件
    √ *请输入领域标识 ... hr
    √ *请输入开发商标识 ... kf00
    √ *请输入苍穹环境地址(格式为：[http/https]://[ip地址/域名]) ... http://172.2.1.1:8022/ierp
    √ 请选择数据中心 » default_datacentor
    √ *请输入OpenAPI第三方应用client_id ... test_id
    √ *请输入OpenAPI第三方应用client_secret ... *****
    √ *请输入OpenAPI第三方应用username ... testuser

**配置项说明**：

| 配置项        | 说明                                                          |
| :------------ | :------------------------------------------------------------ |
| 方案名称      | 自定义控件的方案名称                                          |
| 领域标识      | 自定义控件的领域标识                                          |
| 开发商标识    | 自定义控件的开发商标识                                        |
| 苍穹环境地址  | 用于远程联调的「苍穹」环境地址                                |
| 数据中心      | 用于远程联调的「苍穹」环境数据中心                            |
| client_id     | 在上述「苍穹」环境上创建的 OpenAPI 第三方应用的 client_id     |
| client_secret | 在上述「苍穹」环境上创建的 OpenAPI 第三方应用的 client_secret |
| username      | 在上述「苍穹」环境上创建的 OpenAPI 第三方应用的 username      |

:::info
输入 OpenAPI 第三方应用信息是为了完成「苍穹」环境的登录认证，确保 XML 元数据能成功部署。注册流程请参考：[OpenAPI 第三方应用注册流程](https://developer.kingdee.com/knowledge/525972550665201152?productLineId=29&isKnowledge=2&lang=zh-CN)。
:::

### 第二步：启动本地静态服务器

在本地启动一个静态服务器，为远程「苍穹」环境提供本地前端静态文件的访问入口，仅需在项目根目录执行以下命令：

```bash
node server
```

### 第三步：开启本地动态构建服务

开启后，本地修改的前端代码会自动编译打包，并将最新的静态文件输出到本地静态服务器的对应目录，让远程「苍穹」环境能实时获取本地代码更新，无需手动重新打包。操作分为两步:

1. 打开项目根目录下的 `server/config.js`，将文件中 `localServer` 的属性值改为 `true`;
2. 启动构建服务：在项目根目录执行命令：

```bash
npm run build
```

### 第四步：在「苍穹」环境执行联调

完成上述步骤后，即可在远程「苍穹」环境中打开对应表单，通过 URL 拼接参数让页面加载本地前端文件，实现联调与效果预览。

1. 打开远程「苍穹」环境的控件对应表单设计器页面 / 表单预览页面；
2. 在当前页面的 URL 末尾，拼接本地静态服务器的地址参数：

   ```bash
   &kdcus_cdn=http://localhost:3001
   ```

3. 回车访问拼接后的 URL，即可进入远程联调模式，查看控件在「苍穹」表单中的真实效果。<br>
   <img src="https://tc-cdn.processon.com/po/5cd95fb0e4b06c0492ed0920-695a17c9af380f3b56b02722" style="max-width: 100%; width: 60%;" alt="苍穹">

   <img src="https://tc-cdn.processon.com/po/5cd95fb0e4b06c0492ed0920-695a17d803b6d634b332bfae" style="max-width: 100%; width: 60%;" alt="KWC 预览">

**注意事项**：

- 仅修改本地 「KWC」前端代码：无需重新部署元数据，手动刷新远程「苍穹」的联调页面，即可查看最新代码效果；
- 修改了控件 XML 元数据文件：需在项目根目录执行强制部署命令，将最新元数据重新部署到远程「苍穹」环境，命令如下：
  ```bash
  kd-custom-control-cli deploy -f
  ```
